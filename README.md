# Kaspersky Config Tests

## Описание проекта

Проект предназначен для **автоматической проверки конфигурационного файла Kaspersky** на корректность заполнения параметров.  
Он обеспечивает:

- Проверку значений параметров на соответствие допустимым диапазонам
- Валидацию строковых, булевых, перечисляемых и числовых параметров
- Обнаружение отсутствующих обязательных параметров
- Выявление некорректных секций или неизвестных ключей
- Проверку форматов UUID, локали, файловых путей и таймаутов

Проект полностью покрывает **40 тест-кейсов** (TC01–TC40), включая позитивные и негативные сценарии.

---

## Структура проекта

```plaintext
kaspersky_config_tests/
├── framework/
│   ├── config_reader.py    # Модуль для чтения и проверки конфигурации
│   └── validators.py       # Набор валидаторов для различных типов данных
│
├── tests/
│   └── test_config.py       # Автоматические тесты на pytest
│
├── requirements.txt         # Перечень необходимых библиотек
├── run_tests.sh              # Скрипт создания виртуального окружения и запуска тестов
├── README.md                 # Документация проекта
└── test_cases.md             # Перечень тест-кейсов (опционально, если требуется)
```

## Как работает программа

* Считывает указанный .ini файл конфигурации (по умолчанию: /var/opt/kaspersky/config.ini)

* Проверяет каждую секцию и параметр:

    - Числа — на попадание в допустимый диапазон

    - Строки — на правильный формат

    - Пути — на абсолютность и существование

    - UUID — на корректность структуры

    - Локаль — на соответствие стандарту

    - Таймауты — на наличие суффикса m

    - Генерирует результат валидации (успех/ошибка)

    - Покрывает все возможные ситуации ошибочных и правильных значений

## Быстрый старт: запуск через run_tests.sh

1. Клонируйте проект
```plaintext
cd kaspersky_config_tests
```
2. Дайте права на выполнение скрипта
```plaintext
chmod +x run_tests.sh
```
3. Запустите все тесты через скрипт
```plaintext
./run_tests.sh
```
Скрипт:

*   Создаст виртуальное окружение (venv), если его нет

*   Установит необходимые библиотеки из requirements.txt

*   Запустит тестирование через pytest

После выполнения вы увидите отчёт о прохождении тестов.

##  Альтернативный запуск без run\_tests.sh

Если не хотите использовать готовый скрипт:

1. Создайте виртуальное окружение вручную:
```plaintext
python3 -m venv venv

source venv/bin/activate
```
2. Установите зависимости:
```plaintext
pip install --upgrade pip

pip install -r requirements.txt
```
3. Запустите тесты напрямую через pytest:
```plaintext
pytest -v --durations=10
```
##  Переменная окружения CONFIG_PATH

По умолчанию проект ожидает конфигурацию по пути /var/opt/kaspersky/config.ini.

Если нужно протестировать другой файл, перед запуском установите переменную окружения:

export CONFIG_PATH=/путь/до/своего/config.ini

И затем запустите тесты:
```plaintext
./run_tests.sh
```
или
```plaintext
pytest -v
```
##  Отчёт о тестировании

Проект включает 40 тест-кейсов (позитивные и негативные сценарии).

Каждый параметр проверяется на:

*   Тип данных

*   Диапазоны допустимых значений

*   Форматы строк, UUID и локали

*   Наличие/отсутствие обязательных параметров

*   Все тесты написаны на pytest с покрытием всех возможных кейсов.

##  Системные требования

*   Python 3.8+

*   Модуль venv

*   Linux/MacOS или WSL (для правильной работы путей)

##  Тестовые сценарии для валидации конфигурации

| ID   | Секция   | Параметр                | Значение                             | Тип теста | Ожидаемый результат                          | Описание                                  |
|------|----------|-------------------------|--------------------------------------|-----------|---------------------------------------------|-------------------------------------------|
| TC01 | Общий    | ScanMemoryLimit         | 1024                                | Позитив   | Успешная валидация (граница min)            | Проверка нижней границы                   |
| TC02 | Общий    | ScanMemoryLimit         | 8192                                | Позитив   | Успешная валидация (граница max)            | Проверка верхней границы                  |
| TC03 | Общий    | ScanMemoryLimit         | 10000                               | Негатив   | Ошибка: значение вне диапазона              | Превышение max                            |
| TC04 | Общий    | ScanMemoryLimit         | abc                                 | Негатив   | Ошибка: не число                            | Некорректный тип                          |
| TC05 | Общий    | PackageType             | rpm                                 | Позитив   | Успешная валидация                          | Нижний регистр                            |
| TC06 | Общий    | PackageType             | DEB                                 | Позитив   | Успешная валидация                          | Верхний регистр                           |
| TC07 | Общий    | PackageType             | zip                                 | Негатив   | Ошибка: недопустимое значение               | Недопустимый тип пакета                   |
| TC08 | Общий    | ExecArgMax              | 10                                  | Позитив   | Успешная валидация (min)                    | Нижняя граница                            |
| TC09 | Общий    | ExecArgMax              | 100                                 | Позитив   | Успешная валидация (max)                    | Верхняя граница                           |
| TC10 | Общий    | ExecArgMax              | 5                                   | Негатив   | Ошибка: ниже min                            | Меньше допустимого                        |
| TC11 | Общий    | AdditionalDNSLookup     | true                                | Позитив   | Успешная валидация                          | Boolean (нижний регистр)                  |
| TC12 | Общий    | AdditionalDNSLookup     | No                                  | Позитив   | Успешная валидация                          | Boolean (смешанный регистр)               |
| TC13 | Общий    | CoreDumps               | maybe                               | Негатив   | Ошибка: не boolean                          | Некорректное логическое значение          |
| TC14 | Общий    | CoreDumpsPath           | /tmp                                | Негатив   | Ошибка: директория не существует            | Некорректный путь (если директории нет)   |
| TC15 | Общий    | CoreDumpsPath           | /var/opt/kaspersky/dumps            | Позитив   | Успешная валидация                          | Существующий абсолютный путь              |
| TC16 | Общий    | MachineId               | 7b5cc0e7-0205-48e1-bf63-347531eef193 | Позитив   | Успешная валидация                          | Корректный UUID                           |
| TC17 | Общий    | MachineId               | 12345                               | Негатив   | Ошибка: некорректный UUID                   | Неверный формат UUID                      |
| TC18 | Общий    | Locale                  | en_US.UTF-8                         | Позитив   | Успешная валидация                          | Корректный формат Locale                  |
| TC19 | Общий    | Locale                  | english_US                          | Негатив   | Ошибка: некорректный формат                 | Некорректный формат Locale                |
| TC20 | Watchdog | ConnectTimeout          | 1m                                  | Позитив   | Успешная валидация (min)                    | Нижняя граница                            |
| TC21 | Watchdog | ConnectTimeout          | 120m                                | Позитив   | Успешная валидация (max)                    | Верхняя граница                           |
| TC22 | Watchdog | ConnectTimeout          | 0m                                  | Негатив   | Ошибка: ниже min                            | Меньше допустимого                        |
| TC23 | Watchdog | MaxVirtualMemory        | off                                 | Позитив   | Успешная валидация                          | Значение "off"                            |
| TC24 | Watchdog | MaxVirtualMemory        | 50.5                                | Позитив   | Успешная валидация                          | Вещественное число в диапазоне           |
| TC25 | Watchdog | MaxVirtualMemory        | 150.0                               | Негатив   | Ошибка: выше допустимого диапазона          | Значение > 100                            |
| TC26 | Watchdog | MaxMemory               | auto                                | Позитив   | Успешная валидация                          | Значение "auto"                           |
| TC27 | Watchdog | MaxMemory               | 0                                   | Негатив   | Ошибка: не больше 0                         | Граничное негативное значение             |
| TC28 | Watchdog | PingInterval            | 100                                 | Позитив   | Успешная валидация (min)                    | Нижняя граница                            |
| TC29 | Watchdog | PingInterval            | 10000                               | Позитив   | Успешная валидация (max)                    | Верхняя граница                           |
| TC30 | Watchdog | PingInterval            | 50                                  | Негатив   | Ошибка: ниже min                            | Меньше допустимого                        |
| TC31 | Общий    | Отсутствует секция Watchdog | -                              | Негатив   | Ошибка: секция не найдена                   | Полное отсутствие секции                  |
| TC32 | Общий    | Отсутствует секция General | -                               | Негатив   | Ошибка: секция не найдена                   | Полное отсутствие секции                  |
| TC33 | Общий    | Лишний параметр в General | Dummy=1                         | Негатив   | Ошибка: неизвестный параметр                | Проверка запрета дополнительных ключей    |
| TC34 | Общий    | MachineId отсутствует   | -                                   | Негатив   | Ошибка: параметр не найден                  | Нет ключа MachineId                       |
| TC35 | Watchdog | ConnectTimeout отсутствует | -                              | Негатив   | Ошибка: параметр не найден                  | Нет ключа ConnectTimeout                  |
| TC36 | Все      | Пустой файл             | (пусто)                             | Негатив   | Ошибка: отсутствуют все секции              | Полностью пустой config.ini               |
| TC37 | Watchdog | ConnectTimeout          | 20                                  | Негатив   | Ошибка: нет суффикса 'm'                    | Отсутствие 'm' у значения таймаута        |
| TC38 | Watchdog | MaxMemory               | abc                                 | Негатив   | Ошибка: неправильный формат                 | Строка вместо числа                       |
| TC39 | Общий    | CoreDumpsPath           | relative/path                       | Негатив   | Ошибка: путь не абсолютный                  | Путь не начинается с '/'                  |
| TC40 | Общий    | UseFanotify             | maybe                               | Негатив   | Ошибка: неправильное булевое значение       | Недопустимое логическое значение          |

**Примечание:** Для каждого теста выполняется проверка соответствующего исключения или возвращаемого булевого результата.
